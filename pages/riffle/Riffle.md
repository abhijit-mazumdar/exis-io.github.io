# Riffle

Riffle is the protocol all [domains][domain] use to communicate with one another. Every program adds riffle code, or the *client libraries*, to their projects. It runs atop [websockets](http://www.html5rocks.com/en/tutorials/websockets/basics/). 

## General

Riffle provides an interface for interacting with all software on the [fabric][fabric]. Its here to make your life easier by making conventions and common practices rock solid. Riffle handles the following:

1. Type guarantees
2. Serialization
3. Connection Management
4. Authentication
5. Addressing

## Specs

This section describes how Riffle looks and behaves. For now, the interface is described in `pseudocode` and `swift`.

### Setup and Connection

#### Installation

*Abstract*: use your favorite package manager.

* *Python*: pip
* *Swift*: cocoapods 

#### Configuration

Riffle configuration is handled through static methods on the riffle library. 


```go
// Set the url to connect to. Defaults to *node.exis.io*
func setFabric(string, url)

// Prints internal logging messages
func setDebugging()

print('asdf')
```



### Domain

[Domains][domain] are represented through the *Domain* class. Each instance of the class represents a program running somewhere. You must instantiate at least one domain in order to connect to the fabric.


*Interface*


```
// Set the url to connect to. Defaults to *node.exis.io*
func setFabric(string, url)
```



```
// Set the url to connect to. Defaults to *node.exis.io*
func setDebugging() {}
```



```text
# Create a new domain as a root domain. This is usually the app.
init(string name) 

# Create as a subdomain. Represents you, other subdomains within the app, etc
# If the superdomain had already joined the fabric this domain immediately joins
init(string name, Domain superdomain) 


# Connect to a fabric. Subdomains and superdomains are automatically connected.
# Always call join on the domain representing the current instance
join()

# Disconnect this domain from the fabric. Superdomains and subdomains are not disconnected.
# Automatically undos any registrations or subscriptions called on this domain
leave()

# Delegate methods called when the domain joins or leaves the fabric. If a delegate is set these methods are called on the delegate, else they are called here.
onJoin()
onLeave()

# Catches errors that occur on any operation that doesn't have an error handler 
onError(string endpoint)
```

#### Messaging Patterns

Every messaging call returns a deferred. The deferred succeeds or fails appropriately. Deferreds can be ignored, in which case subsequent calls to the following methods proceed concurrently. If the deferred does not have an error handler the domain automatically logs the error in onError.

```
deferred register(string domain, function handler)
deferred subscribe(string domain, function handler)
deferred publish(string domain, any... arguments)
deferred call(string domain, any... arguments, function handler)

deferred unregister(string domain)
deferred unsubscribe(string domain)
```

Every messaging pattern call except publish accepts a pointer to a function. This function must have arguments and return types that are *Cuminicable*, see section below. 

*Call* and *subscribe* function handlers cannot return values. *Register* may return values.


#### Cumin

Cumin is a library that provides type safety from any data passed into riffle domains. It guarantees that any function always received the types it expects. 

When communicating over the fabric you can only send the following primitive types directly:

* Int
* String
* Bool
* Float
* Double

Collections and Objects must be composed of the primitives above. These are:

* RiffleModel
* Array
* Dictionary

#### Riffle Model

A base class for models that allows them to be transmitted. It does not expose an obvious public interface except for the following:

* autogenerated `riffleId` 
* `toString` override 

WIP.


[message]:/pages/riffle/Message.md
[agent]:/pages/riffle/Agent.md
[node]:/pages/fabric/Node.md
[fabric]:/pages/fabric/Fabric.md
[domain]:/pages/riffle/Domain.md
[action]:/pages/riffle/Agent.md
[endpoint]:/pages/riffle/Endpoint.md
[samples]:/pages/samples/Samples.md

[auth]:/pages/appliances/Auth-Appliance.md

[perm]:/pages/security/Permission.md